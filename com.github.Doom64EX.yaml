app-id: com.github.Doom64EX
sdk: org.gnome.Sdk
runtime: org.gnome.Platform
runtime-version: 3.26
command: com.github.Doom64EX

finish-args:
  # OpenGL
  - --device=dri

  # Create windows
  - --socket=x11
  - --socket=wayland

  # Audio
  - --socket=pulseaudio

modules:
  # Boost includes aren't in org.freedesktop.Sdk sadly, so download and install
  - name: boost
    buildsystem: simple
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.67.0/source/boost_1_67_0.tar.bz2
        sha256: 2684c972994ee57fc5632e03bf044746f6eb45d4920c343937a465fd67a5adba

    ## Only copy the include directory, since that's all we're using.
    build-commands:
      - mkdir -p /app/include
      - cp -R boost /app/include

    ## Commands to compile boost in case we ever decide to include any boost
    ## libraries
    # build-commands:
    #   - ./bootstrap.sh --prefix=/app --with-libraries=
    #   - ./b2 --build-type=minimal --type=shared
    #   - ./b2 --build-type=minimal --type=shared install

    cleanup:
      - /include

  # GLBinding
  - name: glbinding
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/cginternals/glbinding/archive/v3.0.2.tar.gz
        sha256: 23a383f3ed31af742a4952b6c26faa9c346dd982ba9112c68293a578a6e542ad
    config-opts:
      - -DBUILD_SHARED_LIBS=OFF
      - -DOPTION_SELF_CONTAINED=ON
      - -DOPTION_BUILD_TOOLS=OFF
      - -DOPTION_BUILD_EXAMPLES=OFF

    cleanup:
      - /include
      - /lib

  # Fluidsynth
  - name: fluidsynth
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/dotfloat/fluidsynth-lite.git

    cleanup:
      - /include
      - /lib

  # Finally, build the actual project
  - name: doom64ex
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/svkaiser/Doom64EX.git
        branch: rom

    config-opts:
      - -Denable_gtk3=true
      - -Dprogram_name=com.github.Doom64EX

    cleanup:
      - /include
